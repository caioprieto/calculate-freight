<h6 style="margin-top: 1px; display: flex">
  <i class="bi bi-play-btn-fill text-dark fs-5" style="margin-right: 13px; margin-top: -2.5px;"></i>
  <span style="font-size: 17px;">Cursos</span>
</h6>

<%= form_with url: delete_multiple_admin_cursos_path, method: :post, local: true do %>
  <a href="/admin/cursos/new" class="btn btn-success px-3 py-2" style="margin-top: 8px; border-radius: 3px">
    <i class="bi bi-plus-circle-fill fs-6" style="margin-right: 2px"></i>
    <span style="margin-top: -10px; position: relative; top: -1px; font-weight: 600; font-size: 13px;">Criar novo curso</span>
  </a>

  <%= button_tag type: "submit", id: "delete-button", class: "btn btn-danger px-3 py-2", style: "margin-top: 8px; border-radius: 3px", disabled: true do %>
    <i class="bi bi-trash-fill fs-6" style="margin-right: 3px"></i>
    <span style="top: -1px; position: relative; font-weight: 600; font-size: 14px;">Excluir selecionados</span>
  <% end %>

  <table class="table table-admin table-sm table-bordered mt-3 text-center" style="width: 97%;">
    <thead>
      <tr>
        <th style="width: 30px;"> <input type="checkbox" id="select-all" /> </th>
        <th scope="col">Nome do Curso</th>
        <th scope="col">Prova</th>
        <th scope="col">Vigência</th>
        <th scope="col">Valor</th>
        <th scope="col">Qtd Módulos</th>
        <th scope="col">Qtd Aulas</th>
        <th scope="col">Qtd Redações</th>
        <th scope="col">Última Atualização</th>
        <th scope="col"></th>
      </tr>
    </thead>
    <tbody>
      <% @cursos.each do |curso| %>
        <tr>
          <td>
            <%= check_box_tag "curso_ids[]", curso.id, false, class: "curso-checkbox" %>
          </td>
          <td><%= curso.name %></td>
          <td><%= curso.prova.upcase %></td>
          <td><%= curso.vigencia %> Meses</td>
          <td><%= number_to_currency(curso.value, unit: "R$", separator: ",", delimiter: ".", format: "%u %n")  %></td>
          <td><%= curso.modulos.length %> módulos</td>
          <td><%= curso.aulas.length %> aulas</td>
          <td><%= curso.words.length %> redações</td>
          <td><%= curso.updated_at.in_time_zone('America/Sao_Paulo').strftime('%d/%m/%Y %H:%M:%S') %>
          <td style="font-size: 16px; font-weight: 450; padding-left: 4px;">
            <%= link_to edit_admin_curso_path(curso), style: "text-decoration: none; color: black; display: flex", class: "hover" do %>
              <i class="bi bi-pencil-square text-dark fs-6" style="position: relative; left: 3px; bottom: 3px" ></i>
              <span style="text-decoration: none; font-size: 12px; margin-top: 0px; margin-left: 6px;">Editar</span>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const selectAll = document.getElementById("select-all");
    const checkboxes = document.querySelectorAll(".curso-checkbox");
    const deleteButton = document.getElementById("delete-button");

    function updateButtonState() {
      const anyChecked = Array.from(checkboxes).some(cb => cb.checked);
      deleteButton.disabled = !anyChecked;
    }

    checkboxes.forEach(cb => {
      cb.addEventListener("change", updateButtonState);
    });

    if (selectAll) {
      selectAll.addEventListener("change", () => {
        checkboxes.forEach(cb => cb.checked = selectAll.checked);
        updateButtonState();
      });
    }

    // Estado inicial
    updateButtonState();
  });
</script>
