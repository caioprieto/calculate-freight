<%= form_with(model: [:admin, @curso], local: true, html: { class: "curso-form" }) do |form| %>
  <h6 style="margin-top: 1px; display: flex">
    <i class="bi bi-play-btn-fill text-dark fs-5" style="margin-right: 13px; margin-top: -2px;"></i>
    <%= @curso.id.present? ? "Editar Curso - #{@curso.id}" : "Novo Curso" %>
  </h6>
  <%= render "actions", f: form %>
  <div style="width: 100%">
    <%= render partial: "layouts/shared/errors", locals: { resource: @curso } %>
    <div class="mt-4">
      <%= render partial: "layouts/shared/alert" %>
    </div>
  </div>

  <% if @curso.id.present? %>
    <div class="mt-4" style="width: 100%">
      <div style="flex-direction: column; width: 100%;">
        <div class="col" style="margin-top: 14px;">
          <div class="full-width-container card mb-2 rounded-4 w-100 hover p-2">
            <a class="hover" style="text-decoration: none; color: black">
              <div class="row g-0">
                <div class="col-md-4 d-flex align-items-center justify-content-center">
                  <% if @curso.imagem.present? %>
                    <%= image_tag @curso.imagem, class: "", alt: @curso.name, style: "max-height: 180px; max-width: 100%; object-fit: contain; border-radius: 5px;" %>
                  <% end %>
                </div>
                <div class="col-md-8">
                  <div class="card-body">
                    <h5 class="card-title" style="font-size: 17px; font-weight: 350"><%= @curso.name %></h5>
                    <strong class="mb-5" style="font-size: 16px; font-weight: 600;" >R$ <%= number_with_precision(@curso.value, precision: 2, separator: ",") %></strong>
                    <span class="preco-riscado">R$ <%= number_with_precision(@curso.value_riscado, precision: 2, separator: ",") %></span>

                    <div class="row mt-3">
                      <div class="col-12 col-md-6 mb-2">
                        <div class="item d-flex align-items-center">
                          <%= form.check_box :grid_horas_video, class: "form-check-input grid-switch me-3", style: "display: none;" %>
                          <i class="bi bi-file-play fs-5 me-2"></i>
                          <span style="font-size: 12px;">? horas de vídeo</span>
                        </div>
                      </div>

                      <div class="col-12 col-md-6 mb-2">
                        <div class="item d-flex align-items-center">
                          <%= form.check_box :grid_mobile_and_tv, class: "form-check-input grid-switch me-3", style: "display: none;" %>
                          <i class="bi bi-phone fs-5 me-2"></i>
                          <span style="font-size: 12px;">Acesso no dispositivo móvel e na TV</span>
                        </div>
                      </div>

                      <div class="col-12 col-md-6 mb-2">
                        <div class="item d-flex align-items-center">
                          <%= form.check_box :grid_certificate, class: "form-check-input grid-switch me-3", style: "display: none;" %>
                          <i class="bi bi-trophy fs-5 me-2"></i>
                          <span style="font-size: 12px;">Certificado de conclusão</span>
                        </div>
                      </div>

                      <div class="col-12 col-md-6 mb-2">
                        <div class="item d-flex align-items-center">
                          <%= form.check_box :grid_counter_words, class: "form-check-input grid-switch me-3", style: "display: none;" %>
                          <i class="bi bi-file-earmark-arrow-down fs-5 me-2"></i>
                          <span style="font-size: 12px;"><%= @curso.words.length %> redações disponíveis</span>
                        </div>
                      </div>

                      <div class="col-12 col-md-6 mb-2">
                        <div class="item d-flex align-items-center">
                          <%= form.check_box :grid_correcoes, class: "form-check-input grid-switch me-3", style: "display: none;" %>
                          <i class="bi bi-pen fs-5 me-2"></i>
                          <span style="font-size: 12px;">Correções aprofundadas e dinâmicas</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </a>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <div id="form_container">
    <div class="row mt-4">
      <div class="col-3">
        <div>
          <%= form.label "Nome", class: "form-label" %>
          <%= form.text_field :name, class: "form-control", class: "form-control form-control-sm", style: "margin-top: -8px; font-size: 13px;" %>
        </div>
      </div>

      <div class="col-3">
        <%= form.label :prova, "Prova", class: "form-label" %>
        <div class="d-flex align-items-center" style="gap: 5px;">
          <%= form.select :prova, options_for_select([["Enem", "enem"], ["Fuvest", "usp"], ["Unicamp", "unicamp"], ["Unesp", "unesp"]], @curso.prova), {}, class: "form-select form-select-sm", style: "margin-top: -8px; font-size: 13px;" %>
        </div>
      </div>

      <div class="col-3">
        <%= form.label :tipo, "Tipo do Texto", class: "form-label" %>
        <div class="d-flex align-items-center" style="gap: 5px;">
          <%= form.select :tipo, options_for_select([["Dissertativo Argumentativo", "dissertativo-argumentativo"], ["Dissertativo Descritivo", "dissertativo-descritivo"], ["Carta", "carta"]], @curso.tipo), {}, class: "form-select form-select-sm", style: "margin-top: -8px; font-size: 13px;" %>
        </div>
      </div>

      <div class="col-3">
        <%= form.label :vigencia, "Vigência", class: "form-label" %>
        <div class="d-flex align-items-center" style="gap: 5px;">
          <%= form.select :vigencia, options_for_select([["1 Mês", 1], ["3 Meses", 3], ["6 Meses", 6]], @curso.vigencia), {}, class: "form-select form-select-sm", style: "margin-top: -8px; font-size: 13px;" %>
        </div>
      </div>
    </div>

    <div class="row mt-3">
      <div class="col-6">
        <%= form.label "Descrição", class: "form-label" %>
        <%= form.text_area :description, class: "form-control form-control-sm", rows: 3, style: "margin-top: -8px; font-size: 13px;" %>
      </div>

      <div class="col-6">
        <%= form.label "Descrição", class: "form-label" %>
        <%= form.text_area :description, class: "form-control form-control-sm", rows: 3, style: "margin-top: -8px; font-size: 13px;" %>
      </div>
    </div>

    <div class="mt-4" style="margin-left: 3px">
      <h6 href="/">
        <i class="bi bi-cash fs-5" style="margin-right: 8px"></i>
        <span style="position: relative; top: -1px; font-size: 16px">Pagamento</span>
      </h6>

      <div class="row mt-3">
        <div class="col-3">
          <%= form.label :value, "Valor Total", class: "form-label" %>
          <%= form.text_field :value,
                class: "form-control form-control-sm",
                style: "margin-top: -8px",
                value: number_with_precision(form.object.value, precision: 2, separator: ",", delimiter: ".") %>
          <div class="col-12 mt-2">
            <%= form.label :desconto, "Desconto", class: "form-label" %>
            <%= form.text_field :desconto,
                  class: "form-control form-control-sm",
                  style: "margin-top: -8px",
                  disabled: true,
                  value: "#{form.object.desconto.to_i}%" %>
          </div>
        </div>

        <div class="col-3">
          <%= form.label :value_riscado, "Valor Riscado", class: "form-label" %>
          <%= form.text_field :value_riscado,
                class: "form-control form-control-sm",
                style: "margin-top: -8px",
                value: number_with_precision(form.object.value_riscado, precision: 2, separator: ",", delimiter: ".") %>
          <div class="row">
            <div class="col-6 mt-2">
              <%= form.label :qtd_parcelas, "Qtd Parcelas", class: "form-label" %>
              <%= form.text_field :qtd_parcelas,
                    class: "form-control form-control-sm",
                    style: "margin-top: -8px",
                    value: number_with_precision(form.object.qtd_parcelas, precision: 0, separator: ",", delimiter: ".") %>
            </div>
            <div class="col-6 mt-2">
              <%= form.label :valor_parcela, "Valor Parcela", class: "form-label" %>
              <%= form.text_field :valor_parcela,
                    class: "form-control form-control-sm",
                    style: "margin-top: -8px",
                    disabled: true,
                    value: number_with_precision(form.object.value.blank? ? 0 : number_to_currency((form.object.value / form.object.qtd_parcelas), unit: "R$", separator: ",", delimiter: ".", format: "%u %n"), precision: 0, separator: ",", delimiter: ".") %>
            </div>
          </div>
        </div>

        <div class="col-6">
          <div class="compra-box text-dark" style="margin-top: -3px; width: 95%; margin-left: 20px;">
            <div class="preco">
              <img src="https://cdn.simpleicons.org/pix/00B4AA" alt="Pix" height="32" class="mt-3">
              <span class="me-0 ms-2 preco-antigo"><%= number_to_currency(form.object.value, unit: "R$", separator: ",", delimiter: ".", format: "%u %n") %></span>
              <span class="preco-riscado" style="font-size: 13px; margin-left: 2px;">R$ <%= number_with_precision(form.object.value_riscado, precision: 2, separator: ",") %></span>
              <p class="desconto" style="font-size: 14px; margin-left: 45px; margin-top: -12px;"><%= form.object.desconto.to_i %>% de desconto</p>
            </div>

            <hr>

            <div class="preco d-flex">
              <i class="bi bi-credit-card-fill" style="font-size: 32px;"></i>
              <span class="preco-antigo" style="margin-left: 14px; margin-top: 12px"><%= form.object.value.blank? ? 0 : number_to_currency((form.object.value / form.object.qtd_parcelas), unit: "R$", separator: ",", delimiter: ".", format: "%u %n") %></span>
              <span class="preco-vezes" style="margin-top: 16px; margin-left: 7px; font-size: 12px;"><%= form.object.qtd_parcelas%>x</span>
              <p class="desconto" style="font-size: 12px; margin-top: 16px; margin-left: 3px; font-weight: 700"> sem juros</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <% if @redacoes.present? %>
    <div class="mt-4" style="margin-left: 3px;">
      <h6 href="/">
        <i class="bi bi-book fs-5" style="margin-right: 8px"></i>
        <span style="position: relative; top: -1px; font-size: 16px">Redações</span>
      </h6>
    </div>

    <div id="container_redacoes_escolhidas" class="container-redacoes-escolhidas col-12 mt-3" style="margin-left: -10px;">
      <% @redacoes.each do |word| %>
        <div class="col-12 col-sm-6 col-md-4 col-lg-3 d-flex">
          <a href="/admin/words/<%= word.id%>/edit" class="redacoes-card d-flex flex-column align-items-center text-dark w-100" style="text-decoration: none;">
            <div class="meus-cursos-img position-relative w-100" style="border-radius: 10px;">
              <% if word.imagem.attached? %>
                <% if word.image_type == "cover" %>
                  <%= image_tag word.imagem, style: "max-height: 170px; width: 100%; object-fit: cover; border-radius: 10px 10px 0 0;" %>
                <% elsif word.image_type == "scaledown" %>
                  <%= image_tag word.imagem, style: "max-height: 170px; width: 100%; object-fit: scale-down; border-radius: 10px 10px 0 0;" %>
                <% end %>
              <% end %>
            </div>
            <div class="w-100" style="padding: 10px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); border-radius: 0 0 10px 10px; min-height: 50px;">
              <h6 class="text-dark mb-0" style="font-size: 14px;"><%= word.tema %></h6>
            </div>
          </a>
        </div>
      <% end %>
    </div>
  <% end %>

  <div class="mt-5" style="margin-left: 3px">
    <h6 href="/">
      <i class="bi bi-bounding-box fs-5" style="margin-right: 8px"></i>
      <span style="position: relative; top: -1px; font-size: 16px">Módulos</span>
    </h6>
  </div>

  <div id="container_modulos" style="width: 100%; margin-left: 4px;">
    <div id="modulos">
      <%= form.fields_for :modulos do |modulo_fields| %>
        <%= render "modulos_nested", f: modulo_fields %>
      <% end %>
    </div>

    <template id="modulo-template">
      <%= form.fields_for :modulos, @curso.modulos.build, child_index: "NEW_MODULO" do |modulo_fields| %>
        <%= render "modulos_nested", f: modulo_fields, new_record: true %>
      <% end %>
    </template>

    <template id="aula-template">
      <%= form.fields_for :modulos, @curso.modulos.build, child_index: "NEW_MODULO" do |modulo_fields| %>
        <%= modulo_fields.fields_for :aulas, modulo_fields.object.aulas.build, child_index: "NEW_AULA" do |aula_fields| %>
          <%= render "aulas_nested", f: aula_fields, new_record: true %>
        <% end %>
      <% end %>
    </template>
  </div>
<% end %>
