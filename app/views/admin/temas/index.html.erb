<h6 style="margin-top: 1px; display: flex">
  <i class="bi bi-book-half fs-5" style="margin-right: 13px; margin-top: -2px;"></i>
  <span style="font-size: 17px;">Temas Gratuitos</span>
</h6>

<a href="/admin/temas/new" class="btn btn-success px-3 py-2" style="margin-top: 4px; border-radius: 3px">
  <i class="bi bi-plus-circle-fill fs-6" style="margin-right: 2px"></i>
  <span style="margin-top: -10px; position: relative; top: -1px; font-weight: 600; font-size: 14px;">Criar Tema Gratuito</span>
</a>

<div class="w-100">
  <table class="table table-admin table-sm table-bordered mt-3" style="width: 99%;">
    <thead>
      <tr>
        <th style="width: 30px;"> <input type="checkbox" id="select-all" /> </th>
        <th scope="col">Tema</th>
        <th scope="col">Tipo da Prova</th>
        <th scope="col">Data de criação</th>
        <th scope="col">Imagem</th>
        <th scope="col">PDF</th>
        <th scope="col"></th>
      </tr>
    </thead>
    <tbody>
      <% @temas.each do |tema| %>
        <tr>
          <td>
            <%= check_box_tag "tema_ids[]", tema.id, false, class: "tema-checkbox" %>
          </td>
          <td><%= tema.name %></td>
          <td><%= tema.prova.upcase %></td>
          <td><%= tema.created_at.in_time_zone('America/Sao_Paulo').strftime('%d/%m/%Y %H:%M:%S') %></td>
          <td>
            <% if tema.capa.attached? %>
              <i class='bi bi-check-circle-fill text-success fs-5 d-flex hover' style="margin-top: 5px;"></i>
            <% else %>
              <i class="bi bi-x-circle-fill text-danger fs-5 d-flex hover" style="margin-left: 10px; margin-top: 5px;"></i>
            <% end %>
          </td>
          <td>
            <% if tema.pdf_file.attached? %>
              <i class='bi bi-check-circle-fill text-success fs-5 d-flex hover' style="margin-left: 3px; margin-top: 5px;"></i>
            <% else %>
              <i class="bi bi-x-circle-fill text-danger fs-5 d-flex hover" style="margin-left: 3px; margin-top: 5px;"></i>
            <% end %>
          </td>
          <td>
            <%= link_to edit_admin_tema_path(tema), style: "text-decoration: none; color: black; display: flex", class: "hover" do %>
              <i class="bi bi-pencil-square text-dark fs-6" style="position: relative; left: 6px; bottom: -1px" ></i>
              <span style="text-decoration: none; font-size: 12px; margin-top: 4px; margin-left: 10px;">Editar</span>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const selectAll = document.getElementById("select-all");
    const checkboxes = document.querySelectorAll(".tema-checkbox");
    const deleteButton = document.getElementById("delete-button");

    function updateButtonState() {
      const anyChecked = Array.from(checkboxes).some(cb => cb.checked);
      deleteButton.disabled = !anyChecked;
    }

    checkboxes.forEach(cb => {
      cb.addEventListener("change", updateButtonState);
    });

    if (selectAll) {
      selectAll.addEventListener("change", () => {
        checkboxes.forEach(cb => cb.checked = selectAll.checked);
        updateButtonState();
      });
    }

    // Estado inicial
    updateButtonState();
  });
</script>
