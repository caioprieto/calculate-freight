<div class="full-width-container">
  <div class="left-panel">
    <div class="video-player">
      <video id="videoPlayer" width="100%" height="100%" controls disablePictureInPicture controlsList="nodownload noremoteplayback">
        <source id="videoSource" src="" type="video/mp4">
        Seu navegador não suporta vídeo
      </video>
    </div>
  </div>

  <div class="right-panel">
    <div class="accordion" id="modulosAccordion">
      <% @curso.modulos.each_with_index do |modulo, index| %>
        <div class="accordion-item">
          <h2 class="accordion-header" id="heading-<%= index %>">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-<%= index %>" aria-expanded="false" aria-controls="collapse-<%= index %>">
              <%= modulo.titulo %>
            </button>
          </h2>
          <div id="collapse-<%= index %>" class="accordion-collapse collapse" aria-labelledby="heading-<%= index %>">
            <div class="accordion-body">
              <ul class="list-group list-group-flush">
                <% modulo.aulas.each do |aula| %>
                  <li class="list-group-item">
                    <a href="#" class="aula-link" data-video-url="<%= aula.video.attached? ? url_for(aula.video) : "" %>">
                      <%= aula.titulo %>
                    </a>
                  </li>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const links = document.querySelectorAll(".aula-link");
    const videoPlayer = document.getElementById("videoPlayer");
    const videoSource = document.getElementById("videoSource");

    links.forEach(link => {
      link.addEventListener("click", (e) => {
        e.preventDefault();
        const videoUrl = link.dataset.videoUrl;
        if (videoUrl) {
          links.forEach(l => l.classList.remove("aula-ativa"));
          link.classList.add("aula-ativa");

          videoSource.src = videoUrl;
          videoPlayer.load();
          videoPlayer.play();
        }
      });
    });
  });
</script>
