<div class="full-width-container">
  <div class="left-panel no-scroll">
    <%= render "left_panel" %>
  </div>

  <div class="right-panel">
    <%= render "right_panel" %>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const links = document.querySelectorAll(".aula-link");
    const videoPlayer = document.getElementById("videoPlayer");
    const videoSource = document.getElementById("videoSource");

    links.forEach(link => {
      link.addEventListener("click", (e) => {
        e.preventDefault();
        const videoUrl = link.dataset.videoUrl;
        if (videoUrl) {
          links.forEach(l => l.classList.remove("aula-ativa"));
          links.forEach(l => l.closest(".list-group-item").classList.remove("test-list"));

          link.classList.add("aula-ativa");
          link.closest(".list-group-item").classList.add("test-list");

          videoSource.src = videoUrl;
          videoPlayer.load();
          videoPlayer.play();

          const aulaTitulo = link.textContent;
          document.getElementById("aulaAtivaTitulo").textContent = aulaTitulo
        }
      });
    });
  });

  document.addEventListener("DOMContentLoaded", () => {
    const checkboxes = document.querySelectorAll(".watched-checkbox");

    checkboxes.forEach((checkbox) => {
      checkbox.addEventListener("change", () => {
        const aulaId = checkbox.dataset.aulaId;
        const cursoId = checkbox.dataset.cursoId;
        const watched = checkbox.checked;

        fetch("/user_aulas", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRF-Token": document.querySelector("meta[name='csrf-token']").content
          },
          body: JSON.stringify({
            aula_id: aulaId,
            curso_id: cursoId,
            watched: watched
          })
        });
      });
    });
  });

  document.addEventListener("DOMContentLoaded", () => {
    const videoPlayer = document.getElementById("videoPlayer");
    const links = Array.from(document.querySelectorAll(".aula-link"));

    videoPlayer.addEventListener("ended", () => {
      const currentLink = document.querySelector(".aula-link.aula-ativa");

      if (!currentLink) return;

      const currentIndex = links.indexOf(currentLink);
      const nextLink = links[currentIndex + 1];

      if (nextLink) {
        nextLink.click();
      } else {
        console.log("Fim do curso ou não há próxima aula.");
      }
    });
  });

</script>
